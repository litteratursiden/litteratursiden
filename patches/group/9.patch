From 829ad9707b0b6b7993e9d6a584d15ed11fbebe05 Mon Sep 17 00:00:00 2001
From: Jaap Jan <mail@jaapjan.nl>
Date: Thu, 7 Jan 2021 13:08:37 +0100
Subject: [PATCH] Issue #2876696: view own unpublished entity permission by
 jhedstrom, jaapjan, robertragas

---
 src/Plugin/GroupContentPermissionProvider.php    |  5 +++--
 tests/src/Kernel/EntityAccessComplexTest.php     |  7 ++++---
 tests/src/Kernel/EntityQueryAlterComplexTest.php | 16 ++++++++--------
 .../Unit/GroupContentPermissionProviderTest.php  |  6 ++++--
 4 files changed, 19 insertions(+), 15 deletions(-)

diff --git a/src/Plugin/GroupContentPermissionProvider.php b/src/Plugin/GroupContentPermissionProvider.php
index 014f374..2c5cf04 100644
--- a/src/Plugin/GroupContentPermissionProvider.php
+++ b/src/Plugin/GroupContentPermissionProvider.php
@@ -117,11 +117,12 @@ class GroupContentPermissionProvider extends GroupContentHandlerBase implements
   public function getEntityViewUnpublishedPermission($scope = 'any') {
     if ($this->definesEntityPermissions) {
       if ($this->implementsPublishedInterface) {
-        // @todo Implement view own unpublished permission and add it here by
-        // checking for $this->implementsOwnerInterface.
         if ($scope === 'any') {
           return "view $scope unpublished $this->pluginId entity";
         }
+        if ($scope === 'own' && $this->implementsOwnerInterface) {
+          return "view $scope unpublished $this->pluginId entity";
+        }
       }
     }
     return FALSE;

--
GitLab

